CXX   = arm-linux-gnueabi-g++
STRIP = arm-linux-gnueabi-strip

BUILD ?=
PRJ_DIR   = ..
BUILD_DIR = $(PRJ_DIR)/build/${BUILD}
OBJ_DIR   = $(PRJ_DIR)/bin/${BUILD}
INCL_DIR  = $(PRJ_DIR)/include
SRC_DIR   = $(PRJ_DIR)/src
LIB_DIR   = $(PRJ_DIR)/lib

EXEC = $(BUILD_DIR)/exec
SRCS = $(wildcard $(SRC_DIR)/*.cpp)
OBJS = $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(SRCS))

CXXFLAGS.      = -I$(INCL_DIR) -Wall -O2 -march=armv5te -std=c++0x
CXXFLAGS.debug =  $(CXXFLAGS.) -g -DDEBUG
LDFLAGS = -static-libgcc
LDLIBS  = # Load libraries

.PHONY: all run clean

all: $(EXEC)

$(EXEC): $(OBJS) | $(BUILD_DIR)
	$(CXX) $(LDFLAGS) -o $@ $^ $(LDLIBS)
	$(STRIP) $@

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp | $(OBJ_DIR)
	$(CXX) $(CXXFLAGS.$(BUILD)) -c -o $@ $<

$(BUILD_DIR) $(OBJ_DIR) $(LIB_DIR):
	mkdir -p $@

run: $(EXEC)
	$<

clean:
	rm -rf $(OBJ_DIR) $(BUILD_DIR)